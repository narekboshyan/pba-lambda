{"version":"tree-0.1","tree":{"id":"App","path":"","constructInfo":{"fqn":"aws-cdk-lib.App","version":"2.211.0"},"children":{"VideoProcessingStack":{"id":"VideoProcessingStack","path":"VideoProcessingStack","constructInfo":{"fqn":"aws-cdk-lib.Stack","version":"2.211.0"},"children":{"VideoProcessingBucket":{"id":"VideoProcessingBucket","path":"VideoProcessingStack/VideoProcessingBucket","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.BucketBase","version":"2.211.0","metadata":[]},"children":{"Notifications":{"id":"Notifications","path":"VideoProcessingStack/VideoProcessingBucket/Notifications","constructInfo":{"fqn":"constructs.Construct","version":"10.4.2"},"children":{"Resource":{"id":"Resource","path":"VideoProcessingStack/VideoProcessingBucket/Notifications/Resource","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.211.0"}}}},"AllowBucketNotificationsToVideoProcessingStackVideoToHLSProcessorFunctionA5977A5C":{"id":"AllowBucketNotificationsToVideoProcessingStackVideoToHLSProcessorFunctionA5977A5C","path":"VideoProcessingStack/VideoProcessingBucket/AllowBucketNotificationsToVideoProcessingStackVideoToHLSProcessorFunctionA5977A5C","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnPermission","version":"2.211.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Permission","aws:cdk:cloudformation:props":{"action":"lambda:InvokeFunction","functionName":{"Fn::GetAtt":["VideoToHLSProcessorFunction7DE28E20","Arn"]},"principal":"s3.amazonaws.com","sourceAccount":{"Ref":"AWS::AccountId"},"sourceArn":{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":s3:::pba-test-mediaconvert"]]}}}}}},"FFmpegVideoProcessingLayer":{"id":"FFmpegVideoProcessingLayer","path":"VideoProcessingStack/FFmpegVideoProcessingLayer","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.211.0","metadata":[]}},"VideoToHLSProcessorFunction":{"id":"VideoToHLSProcessorFunction","path":"VideoProcessingStack/VideoToHLSProcessorFunction","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda_nodejs.NodejsFunction","version":"2.211.0","metadata":[]},"children":{"ServiceRole":{"id":"ServiceRole","path":"VideoProcessingStack/VideoToHLSProcessorFunction/ServiceRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.211.0","metadata":[]},"children":{"ImportServiceRole":{"id":"ImportServiceRole","path":"VideoProcessingStack/VideoToHLSProcessorFunction/ServiceRole/ImportServiceRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.211.0","metadata":[]}},"Resource":{"id":"Resource","path":"VideoProcessingStack/VideoToHLSProcessorFunction/ServiceRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.211.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"lambda.amazonaws.com"}}],"Version":"2012-10-17"},"managedPolicyArns":[{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"]]}]}}},"DefaultPolicy":{"id":"DefaultPolicy","path":"VideoProcessingStack/VideoToHLSProcessorFunction/ServiceRole/DefaultPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.211.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"VideoProcessingStack/VideoToHLSProcessorFunction/ServiceRole/DefaultPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.211.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":["s3:GetObject","s3:GetObjectVersion","s3:PutObject","s3:PutObjectAcl","s3:DeleteObject"],"Effect":"Allow","Resource":{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":s3:::pba-test-mediaconvert/*"]]}},{"Action":["s3:ListBucket","s3:GetBucketLocation","s3:GetBucketVersioning"],"Effect":"Allow","Resource":{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":s3:::pba-test-mediaconvert"]]}},{"Action":["logs:CreateLogGroup","logs:CreateLogStream","logs:PutLogEvents","cloudwatch:PutMetricData"],"Effect":"Allow","Resource":"*"}],"Version":"2012-10-17"},"policyName":"VideoToHLSProcessorFunctionServiceRoleDefaultPolicy8FFA4FB4","roles":[{"Ref":"VideoToHLSProcessorFunctionServiceRole5CD09B16"}]}}}}}}},"Code":{"id":"Code","path":"VideoProcessingStack/VideoToHLSProcessorFunction/Code","constructInfo":{"fqn":"aws-cdk-lib.aws_s3_assets.Asset","version":"2.211.0"},"children":{"Stage":{"id":"Stage","path":"VideoProcessingStack/VideoToHLSProcessorFunction/Code/Stage","constructInfo":{"fqn":"aws-cdk-lib.AssetStaging","version":"2.211.0"}},"AssetBucket":{"id":"AssetBucket","path":"VideoProcessingStack/VideoToHLSProcessorFunction/Code/AssetBucket","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.BucketBase","version":"2.211.0","metadata":[]}}}},"Resource":{"id":"Resource","path":"VideoProcessingStack/VideoToHLSProcessorFunction/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnFunction","version":"2.211.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Function","aws:cdk:cloudformation:props":{"architectures":["x86_64"],"code":{"s3Bucket":{"Fn::Sub":"cdk-hnb659fds-assets-${AWS::AccountId}-eu-west-1"},"s3Key":"36f75d5d25f49d5af56f09836326f23ad879ddf1a9435afa9bb47e78021c991d.zip"},"environment":{"variables":{"NODE_OPTIONS":"--max-old-space-size=2048","FFMPEG_PATH":"/opt/bin/ffmpeg","VIDEO_PROCESSING_BUCKET":"pba-test-mediaconvert","LOG_LEVEL":"INFO"}},"handler":"index.handler","layers":["arn:aws:lambda:us-east-1:533267207907:layer:ffmpeg:1"],"memorySize":3008,"role":{"Fn::GetAtt":["VideoToHLSProcessorFunctionServiceRole5CD09B16","Arn"]},"runtime":"nodejs20.x","timeout":900}}},"LogRetention":{"id":"LogRetention","path":"VideoProcessingStack/VideoToHLSProcessorFunction/LogRetention","constructInfo":{"fqn":"aws-cdk-lib.aws_logs.LogRetention","version":"2.211.0"},"children":{"Resource":{"id":"Resource","path":"VideoProcessingStack/VideoToHLSProcessorFunction/LogRetention/Resource","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.211.0"}}}},"LogGroup":{"id":"LogGroup","path":"VideoProcessingStack/VideoToHLSProcessorFunction/LogGroup","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.211.0","metadata":[]}}}},"LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8a":{"id":"LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8a","path":"VideoProcessingStack/LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8a","constructInfo":{"fqn":"constructs.Construct","version":"10.4.2"},"children":{"Code":{"id":"Code","path":"VideoProcessingStack/LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8a/Code","constructInfo":{"fqn":"aws-cdk-lib.aws_s3_assets.Asset","version":"2.211.0"},"children":{"Stage":{"id":"Stage","path":"VideoProcessingStack/LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8a/Code/Stage","constructInfo":{"fqn":"aws-cdk-lib.AssetStaging","version":"2.211.0"}},"AssetBucket":{"id":"AssetBucket","path":"VideoProcessingStack/LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8a/Code/AssetBucket","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.BucketBase","version":"2.211.0","metadata":[]}}}},"ServiceRole":{"id":"ServiceRole","path":"VideoProcessingStack/LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8a/ServiceRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.211.0","metadata":[]},"children":{"ImportServiceRole":{"id":"ImportServiceRole","path":"VideoProcessingStack/LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8a/ServiceRole/ImportServiceRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.211.0","metadata":[]}},"Resource":{"id":"Resource","path":"VideoProcessingStack/LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8a/ServiceRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.211.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"lambda.amazonaws.com"}}],"Version":"2012-10-17"},"managedPolicyArns":[{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"]]}]}}},"DefaultPolicy":{"id":"DefaultPolicy","path":"VideoProcessingStack/LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8a/ServiceRole/DefaultPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.211.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"VideoProcessingStack/LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8a/ServiceRole/DefaultPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.211.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":["logs:PutRetentionPolicy","logs:DeleteRetentionPolicy"],"Effect":"Allow","Resource":"*"}],"Version":"2012-10-17"},"policyName":"LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aServiceRoleDefaultPolicyADDA7DEB","roles":[{"Ref":"LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aServiceRole9741ECFB"}]}}}}}}},"Resource":{"id":"Resource","path":"VideoProcessingStack/LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8a/Resource","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.211.0"}}}},"BucketNotificationsHandler050a0587b7544547bf325f094a3db834":{"id":"BucketNotificationsHandler050a0587b7544547bf325f094a3db834","path":"VideoProcessingStack/BucketNotificationsHandler050a0587b7544547bf325f094a3db834","constructInfo":{"fqn":"constructs.Construct","version":"10.4.2"},"children":{"Role":{"id":"Role","path":"VideoProcessingStack/BucketNotificationsHandler050a0587b7544547bf325f094a3db834/Role","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.211.0","metadata":[]},"children":{"ImportRole":{"id":"ImportRole","path":"VideoProcessingStack/BucketNotificationsHandler050a0587b7544547bf325f094a3db834/Role/ImportRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.211.0","metadata":[]}},"Resource":{"id":"Resource","path":"VideoProcessingStack/BucketNotificationsHandler050a0587b7544547bf325f094a3db834/Role/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.211.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"lambda.amazonaws.com"}}],"Version":"2012-10-17"},"managedPolicyArns":[{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"]]}]}}},"DefaultPolicy":{"id":"DefaultPolicy","path":"VideoProcessingStack/BucketNotificationsHandler050a0587b7544547bf325f094a3db834/Role/DefaultPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.211.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"VideoProcessingStack/BucketNotificationsHandler050a0587b7544547bf325f094a3db834/Role/DefaultPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.211.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":"s3:PutBucketNotification","Effect":"Allow","Resource":"*"},{"Action":"s3:GetBucketNotification","Effect":"Allow","Resource":"*"}],"Version":"2012-10-17"},"policyName":"BucketNotificationsHandler050a0587b7544547bf325f094a3db834RoleDefaultPolicy2CF63D36","roles":[{"Ref":"BucketNotificationsHandler050a0587b7544547bf325f094a3db834RoleB6FB88EC"}]}}}}}}},"Resource":{"id":"Resource","path":"VideoProcessingStack/BucketNotificationsHandler050a0587b7544547bf325f094a3db834/Resource","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.211.0"}}}},"VideoProcessingMonitoringDashboard":{"id":"VideoProcessingMonitoringDashboard","path":"VideoProcessingStack/VideoProcessingMonitoringDashboard","constructInfo":{"fqn":"aws-cdk-lib.aws_cloudwatch.Dashboard","version":"2.211.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"VideoProcessingStack/VideoProcessingMonitoringDashboard/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_cloudwatch.CfnDashboard","version":"2.211.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::CloudWatch::Dashboard","aws:cdk:cloudformation:props":{"dashboardBody":{"Fn::Join":["",["{\"widgets\":[{\"type\":\"metric\",\"width\":12,\"height\":6,\"x\":0,\"y\":0,\"properties\":{\"view\":\"timeSeries\",\"title\":\"Lambda Function Invocations\",\"region\":\"",{"Ref":"AWS::Region"},"\",\"metrics\":[[\"AWS/Lambda\",\"Invocations\",\"FunctionName\",\"",{"Ref":"VideoToHLSProcessorFunction7DE28E20"},"\",{\"stat\":\"Sum\"}]],\"yAxis\":{}}},{\"type\":\"metric\",\"width\":12,\"height\":6,\"x\":12,\"y\":0,\"properties\":{\"view\":\"timeSeries\",\"title\":\"Lambda Function Errors\",\"region\":\"",{"Ref":"AWS::Region"},"\",\"metrics\":[[\"AWS/Lambda\",\"Errors\",\"FunctionName\",\"",{"Ref":"VideoToHLSProcessorFunction7DE28E20"},"\",{\"stat\":\"Sum\"}]],\"yAxis\":{}}},{\"type\":\"metric\",\"width\":12,\"height\":6,\"x\":0,\"y\":6,\"properties\":{\"view\":\"timeSeries\",\"title\":\"Processing Duration\",\"region\":\"",{"Ref":"AWS::Region"},"\",\"metrics\":[[\"AWS/Lambda\",\"Duration\",\"FunctionName\",\"",{"Ref":"VideoToHLSProcessorFunction7DE28E20"},"\"]],\"yAxis\":{}}},{\"type\":\"metric\",\"width\":12,\"height\":6,\"x\":12,\"y\":6,\"properties\":{\"view\":\"timeSeries\",\"title\":\"Function Throttles\",\"region\":\"",{"Ref":"AWS::Region"},"\",\"metrics\":[[\"AWS/Lambda\",\"Throttles\",\"FunctionName\",\"",{"Ref":"VideoToHLSProcessorFunction7DE28E20"},"\",{\"stat\":\"Sum\"}]],\"yAxis\":{}}}]}"]]},"dashboardName":"VideoProcessingStack-Video-Processing-Monitor"}}}}},"VideoProcessingErrorAlarm":{"id":"VideoProcessingErrorAlarm","path":"VideoProcessingStack/VideoProcessingErrorAlarm","constructInfo":{"fqn":"aws-cdk-lib.aws_cloudwatch.Alarm","version":"2.211.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"VideoProcessingStack/VideoProcessingErrorAlarm/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_cloudwatch.CfnAlarm","version":"2.211.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::CloudWatch::Alarm","aws:cdk:cloudformation:props":{"alarmDescription":"Video processing function encountered an error","comparisonOperator":"GreaterThanOrEqualToThreshold","dimensions":[{"name":"FunctionName","value":{"Ref":"VideoToHLSProcessorFunction7DE28E20"}}],"evaluationPeriods":1,"metricName":"Errors","namespace":"AWS/Lambda","period":300,"statistic":"Sum","threshold":1}}}}},"VideoProcessingDurationAlarm":{"id":"VideoProcessingDurationAlarm","path":"VideoProcessingStack/VideoProcessingDurationAlarm","constructInfo":{"fqn":"aws-cdk-lib.aws_cloudwatch.Alarm","version":"2.211.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"VideoProcessingStack/VideoProcessingDurationAlarm/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_cloudwatch.CfnAlarm","version":"2.211.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::CloudWatch::Alarm","aws:cdk:cloudformation:props":{"alarmDescription":"Video processing taking longer than expected","comparisonOperator":"GreaterThanOrEqualToThreshold","dimensions":[{"name":"FunctionName","value":{"Ref":"VideoToHLSProcessorFunction7DE28E20"}}],"evaluationPeriods":2,"metricName":"Duration","namespace":"AWS/Lambda","period":300,"statistic":"Average","threshold":600000}}}}},"VideoProcessorFunctionName":{"id":"VideoProcessorFunctionName","path":"VideoProcessingStack/VideoProcessorFunctionName","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.211.0"}},"VideoProcessorFunctionArn":{"id":"VideoProcessorFunctionArn","path":"VideoProcessingStack/VideoProcessorFunctionArn","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.211.0"}},"ProcessingBucketName":{"id":"ProcessingBucketName","path":"VideoProcessingStack/ProcessingBucketName","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.211.0"}},"VideoUploadCommand":{"id":"VideoUploadCommand","path":"VideoProcessingStack/VideoUploadCommand","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.211.0"}},"ExpectedHLSOutputUrl":{"id":"ExpectedHLSOutputUrl","path":"VideoProcessingStack/ExpectedHLSOutputUrl","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.211.0"}},"SupportedVideoQualities":{"id":"SupportedVideoQualities","path":"VideoProcessingStack/SupportedVideoQualities","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.211.0"}},"CDKMetadata":{"id":"CDKMetadata","path":"VideoProcessingStack/CDKMetadata","constructInfo":{"fqn":"constructs.Construct","version":"10.4.2"},"children":{"Default":{"id":"Default","path":"VideoProcessingStack/CDKMetadata/Default","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.211.0"}}}},"BootstrapVersion":{"id":"BootstrapVersion","path":"VideoProcessingStack/BootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnParameter","version":"2.211.0"}},"CheckBootstrapVersion":{"id":"CheckBootstrapVersion","path":"VideoProcessingStack/CheckBootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnRule","version":"2.211.0"}}}},"Tree":{"id":"Tree","path":"Tree","constructInfo":{"fqn":"constructs.Construct","version":"10.4.2"}}}}}